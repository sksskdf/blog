---
title: B-Tree Skip Scan
date: 2025-12-01
---

대부분의 RDBMS에서 사용되는 B-Tree 인덱스는 데이터의 효율적인 검색을 위한 핵심 구조이다.
특히, 여러 컬럼으로 구성된 다중 컬럼 B-Tree 인덱스는 엄격한 규칙에 따라 작동한다.

다중 컬럼 (A, B, C) 순서의 B-Tree 인덱스를 생성했을 때, 데이터는 컬럼 A 기준으로 정렬되고, A 값이 같은 경우 B, B 값 까지 같은 경우 C를 기준으로 정렬이 된다.
이 순서는 인덱스를 사용하여 데이터를 검색하는 데 필수적이다.

쿼리 플래너가 이 인덱스를 효율적으로 사용하기 위해선, 반드시 인덱스 정의의 선행 컬럼(접두사)에 대한 필터 조건이 주어져야 했다.

예를 들어 다중 컬럼(region, category, date) 순서의 B-Tree 인덱스가 있다고 했을 때, Skip Scan 기능 이전 버전에서 이 인덱스를 효율적으로 사용하려면, WHERE region = 'East'와 같이 가장 왼쪽 컬럼에 조건(접두사 조건)이 필수적으로 지정되어야 했다.

이 경우 발생하는 주요 문제는 다음과 같다.
SELECT * FROM sales WHERE category = 'Electronics' AND date > '2024-01-01';
해당 쿼리를 실행했을 때 첫째로 인덱스가 무용지물이 된다.
최악의 경우엔 쿼리 플래너는 전체 테이블을 순차적으로 스캔(Sequential Scan)하거나 인덱스를 사용하더라도 모든 region 값을 검색해야 하는 매우 광범위한 인덱스 스캔을 수행해야 했다.
이는 상황에 따라 심각한 성능 저하를 초래했다.

PostgreSQL 18 버전부터 도입된 B-Tree Skip Scan 기능은 위와 같은 접두사 컬럼 누락 문제를
해결하여 인덱스 활용도를 높이고 쿼리 실행 시간을 개선한다.

위 쿼리 예시로 다시 살펴보자면, Skip Scan 이전 버전에서는 
B-Tree 인덱스의 근본적인 구조적 제약과 접두사 원칙 때문에 region의 모든 조합을 확인하여
category = 'Electronics'인 행을 찾아야 했다.

인덱스 스캔은 인덱스 트리를 따라가 조건이 처음 만족되는 정확한 시작점을 찾아야 하지만
region에 대한 조건이 없으면 시작점을 찾을 수가 없다.

Skip Scan 기능이 활성화되면, PostgreSQL은 region 컬럼에 조건이 없더라도 인덱스의
메타데이터나 내부 구조를 활용하여 존재하는 모든 고유한 region 값을 식별한다.

